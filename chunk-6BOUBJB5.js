import{a as Z}from"./chunk-EVQEF2TK.js";import{a as be}from"./chunk-7WW3DIWS.js";import{A as g,B as E,C as ae,D,E as l,Ea as fe,F as j,Fa as Y,Ga as ge,H as P,K as b,L as h,M as v,O as _,P as S,R as le,T as B,U as de,W as k,X as M,Y as pe,aa as me,d as se,e as O,f as re,ga as ce,h as p,i as m,ka as ne,la as ue,m as c,ma as N,n as u,na as T,o as U,oa as x,p as R,pa as V,qa as F,r as I,ra as G,s as y,sa as H,ta as z,u as r,ua as q,v as n,va as J,w as f,x as A,xa as K,y as W,ya as Q,z as w,za as X}from"./chunk-2UE522HU.js";var C=class d{constructor(i,t){this.http=i;this.constService=t;this.BASE_URL=t.FULL_URL+"/user"}BASE_URL;registerUser(i,t,e,s,a){let o=this.BASE_URL+"/new";return this.http.post(o,{id_clan:i,full_name:t,username:e,password:s,profile:a})}getAllUsers(){let i=this.BASE_URL;return this.http.get(i)}getUser(i){let t=this.BASE_URL+"/"+i;return this.http.get(t)}disableUser(i){let t=this.BASE_URL+"/disable";return this.http.patch(t,{id:i})}enableUser(i){let t=this.BASE_URL+"/enable";return this.http.patch(t,{id:i})}updateUser(i,t,e,s){let a=this.BASE_URL+"/update/"+i;return this.http.patch(a,{full_name:t,username:e,profile:s})}deleteUser(i){let t=this.BASE_URL+"/"+i;return this.http.delete(t)}changePasswordOverride(i,t){let e=this.BASE_URL+"/change-password/"+i;return this.http.patch(e,{password:t})}mapUsers(i){let t={};for(let e=0;e<i.length;e++){let s=i[e].id;t[s]=e}return t}static \u0275fac=function(t){return new(t||d)(re(me),re(ue))};static \u0275prov=se({token:d,factory:d.\u0275fac,providedIn:"root"})};var $=class d{constructor(i,t,e,s,a){this.routeService=i;this.route=t;this.userService=e;this.authService=s;this.errorService=a}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.idUser=this.route.snapshot.params.id,this.getUser(this.idUser)}subscriptions=new x;idUser;user;profileType="";newPassword="";getUser(i){this.subscriptions.add=this.userService.getUser(i).subscribe({next:t=>{this.user=t.data,t.token&&this.authService.updateToken(t.token)},complete:()=>{this.user.is_leader?this.profileType="leader":this.user.is_staff?this.profileType="staff":this.user.is_admin&&(this.profileType="admin")},error:t=>{this.errorService.handler(t)}})}toUsersList(){this.routeService.navigate.toUserList()}updateUser(){this.subscriptions.add=this.userService.updateUser(this.idUser,this.user.full_name,this.user.username,this.profileType).subscribe({next:i=>{i.token&&this.authService.updateToken(i.token)},complete:()=>{window.alert("Usu\xE1rio atualizado com sucesso"),this.toUsersList()},error:i=>{this.errorService.handler(i)}})}changePassword(i){i.length<8||!window.confirm(`Deseja realmente alterar a senha do usu\xE1rio ${this.user.full_name.toUpperCase()} | ${this.user.username.toUpperCase()}?
Essa a\xE7\xE3o \xE9 irrevers\xEDvel!`)||(this.subscriptions.add=this.userService.changePasswordOverride(this.user.id,i).subscribe({next:e=>{e.token&&this.authService.updateToken(e.token)},complete:()=>{window.alert("Senha alterada com sucesso"),this.newPassword=""},error:e=>{this.errorService.handler(e)}}))}static \u0275fac=function(t){return new(t||d)(u(N),u(ce),u(C),u(T),u(V))};static \u0275cmp=U({type:d,selectors:[["app-user-edit"]],standalone:!1,decls:67,vars:13,consts:[["idClan",""],[1,"d-flex","flex-column","align-items-center","justify-content-center"],[1,"mb-3"],[1,"bg-dark","bg-opacity-75","border","border-3","border-light","rounded-3","mb-3","p-3"],[1,"d-flex","flex-column","justify-content-center","mb-3"],["for","idClan",1,"fs-4","mb-2"],["disabled","","name","idClan","id","idClan",1,"text-center","rounded","p-1"],["value","","disabled",""],["value","","selected","","disabled",""],["for","userFullName",1,"fs-4","mb-2"],["type","text","name","userFullName","id","userFullName","placeholder","Ex: Skyler",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","userNickname",1,"fs-4","mb-2"],["type","text","name","userNickname","id","userNickname","placeholder","Ex: sky_do_ceu",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-around","mb-3"],[1,"mx-1"],["id","leader","type","radio","name","profile","value","leader",1,"btn-check",3,"ngModelChange","ngModel"],["for","leader",1,"btn","btn-outline-primary","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-megaphone-fill"],["id","staff","type","radio","name","profile","value","staff",1,"btn-check",3,"ngModelChange","ngModel"],["for","staff",1,"btn","btn-outline-warning","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-clipboard-fill"],["id","admin","type","radio","name","profile","value","admin",1,"btn-check",3,"ngModelChange","ngModel"],["for","admin",1,"btn","btn-outline-danger","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-shield-fill-check"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],[1,"text-center","mb-3"],["for","password",1,"fs-4","mb-2"],["type","password","name","password","id","password","placeholder","Senha",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"fw-bold"],[1,"d-flex","align-items-center","justify-content-center","mb-3"],[1,"btn","btn-outline-danger",3,"click","disabled"]],template:function(t,e){if(t&1){let s=w();r(0,"div",1)(1,"h1",2),l(2,"Atualizar usu\xE1rio"),n(),r(3,"div",3)(4,"form")(5,"div",4)(6,"label",5),l(7,"Cl\xE3"),n(),r(8,"select",6,0)(10,"option",7),l(11,"SELECIONE O CL\xC3"),n(),r(12,"option",8),l(13),_(14,"titlecase"),_(15,"uppercase"),n()()(),r(16,"div",4)(17,"label",9),l(18,"Nome completo"),n(),r(19,"input",10),v("ngModelChange",function(o){return p(s),h(e.user.full_name,o)||(e.user.full_name=o),m(o)}),n()(),r(20,"div",4)(21,"label",11),l(22,"Nome de usu\xE1rio"),n(),r(23,"input",12),v("ngModelChange",function(o){return p(s),h(e.user.username,o)||(e.user.username=o),m(o)}),n()(),r(24,"div",13)(25,"div",14)(26,"input",15),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(27,"label",16),l(28,"L\xEDder"),f(29,"br")(30,"i",17),n()(),r(31,"div",14)(32,"input",18),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(33,"label",19),l(34,"Staff"),f(35,"br")(36,"i",20),n()(),r(37,"div",14)(38,"input",21),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(39,"label",22),l(40,"ADM"),f(41,"br")(42,"i",23),n()()(),f(43,"hr"),r(44,"div",24)(45,"button",25),g("click",function(){return p(s),m(e.toUsersList())}),l(46,"Voltar"),n(),r(47,"button",26),g("click",function(){return p(s),m(e.updateUser())}),l(48,"Registrar"),n()()()()(),f(49,"hr"),r(50,"div",1)(51,"h1",27),l(52,"Redefinir senha"),n(),r(53,"div",3)(54,"form")(55,"div",4)(56,"label",28),l(57,"Nova senha"),n(),r(58,"input",29),v("ngModelChange",function(o){return p(s),h(e.newPassword,o)||(e.newPassword=o),m(o)}),n(),f(59,"br"),r(60,"p"),l(61,"Aten\xE7\xE3o, n\xE3o altere a senha sem pr\xE9vio aviso/pedido do usu\xE1rio."),n(),r(62,"p",30),l(63,"Essa a\xE7\xE3o n\xE3o pode ser desfeita!"),n()(),r(64,"div",31)(65,"button",32),g("click",function(){return p(s),m(e.changePassword(e.newPassword))}),l(66,"Atualizar senha"),n()()()()()}t&2&&(c(13),P("",S(14,9,e.user.clan.full_name)," | ",S(15,11,e.user.clan.abbreviation),""),c(6),b("ngModel",e.user.full_name),c(4),b("ngModel",e.user.username),c(3),b("ngModel",e.profileType),c(6),b("ngModel",e.profileType),c(6),b("ngModel",e.profileType),c(20),b("ngModel",e.newPassword),c(7),y("disabled",e.newPassword.length<8))},dependencies:[J,Q,X,F,K,G,H,q,z,M,k],encapsulation:2})};function Ee(d,i){if(d&1){let t=w();r(0,"td",4)(1,"button",15),g("click",function(){p(t);let s=E().$implicit,a=E();return m(a.enableUser(s.id,s.username))}),l(2,"Habilitar"),n()()}}function Ue(d,i){if(d&1){let t=w();r(0,"td")(1,"button",16),g("click",function(){p(t);let s=E().$implicit,a=E();return m(a.disableUser(s.id,s.full_name))}),l(2,"Desabilitar"),n()()}}function ke(d,i){if(d&1){let t=w();A(0),r(1,"tr")(2,"td",4),l(3),_(4,"uppercase"),n(),r(5,"td",4),l(6),_(7,"titlecase"),n(),r(8,"td",4),l(9),n(),I(10,Ee,3,0,"td",10)(11,Ue,3,0,"ng-template",null,0,le),r(13,"td",4)(14,"button",11),g("click",function(){let s=p(t).$implicit,a=E();return m(a.toEditUser(s.id))}),f(15,"i",12),n()(),r(16,"td",4)(17,"button",13),g("click",function(){let s=p(t).$implicit,a=E();return m(a.deleteUser(s.id,s.full_name,s.clan.full_name))}),f(18,"i",14),n()()(),W()}if(d&2){let t=i.$implicit,e=D(12);c(3),j(S(4,5,t.clan.abbreviation)),c(3),j(S(7,7,t.full_name)),c(3),j(t.username),c(),y("ngIf",!t.is_enabled)("ngIfElse",e)}}var ee=class d{constructor(i,t,e,s){this.routesService=i;this.authService=t;this.userService=e;this.errorService=s}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.refreshData()}subscriptions=new x;users=[];usersMap={};refreshData(){this.getUsers()}getUsers(){this.subscriptions.add=this.userService.getAllUsers().subscribe({next:i=>{i.token&&this.authService.updateToken(i.token),this.users=i.data},complete:()=>this.mapIndexes(),error:i=>{this.errorService.handler(i)}})}disableUser(i,t){window.confirm("Desabilitar "+t+"?")&&(this.subscriptions.add=this.userService.disableUser(i).subscribe({next:s=>{s.token&&this.authService.updateToken(s.token)},complete:()=>{window.alert(`Usu\xE1rio ${t} desativado!`),this.users[this.usersMap[i]].is_enabled=!1},error:s=>{this.errorService.handler(s)}}))}enableUser(i,t){window.confirm("Reativar "+t+"?")&&(this.subscriptions.add=this.userService.enableUser(i).subscribe({next:s=>{s.token&&this.authService.updateToken(s.token)},complete:()=>{window.alert(`Usu\xE1rio ${t} reativado!`),this.users[this.usersMap[i]].is_enabled=!0},error:s=>{this.errorService.handler(s)}}))}toEditUser(i){this.routesService.navigate.toUserEdit(i)}deleteUser(i,t,e){window.confirm(`Remover todos os acessos de ${t} do cl\xE3 ${e.toUpperCase()}?`)&&(this.subscriptions.add=this.userService.deleteUser(i).subscribe({next:a=>{a.token&&this.authService.updateToken(a.token)},complete:()=>{window.alert("Usu\xE1rio removido");let a=this.usersMap[i];this.users.splice(a,1),this.mapIndexes()},error:a=>{this.errorService.handler(a)}}))}mapIndexes(){this.usersMap=this.userService.mapUsers(this.users)}static \u0275fac=function(t){return new(t||d)(u(N),u(T),u(C),u(V))};static \u0275cmp=U({type:d,selectors:[["app-user-list"]],standalone:!1,decls:19,vars:1,consts:[["notEnabled",""],[1,"d-flex","justify-content-around","my-2","p-1","align-items-center"],[3,"refreshData"],[1,"table","table-striped","table-bordered","text-center"],[1,"align-middle"],["colspan","1","rowspan","2",1,"fs-4"],["colspan","2",1,"fs-4"],["colspan","3","rowspan","2",1,"fs-4"],[1,"fs-4"],[4,"ngFor","ngForOf"],["class","align-middle",4,"ngIf","ngIfElse"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-square"],[1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash-fill"],[1,"btn","btn-outline-success",3,"click"],[1,"btn","btn-outline-warning",3,"click"]],template:function(t,e){t&1&&(r(0,"div",1),f(1,"app-button-back-to-menu"),r(2,"app-button-refresh-data",2),g("refreshData",function(){return e.refreshData()}),n()(),r(3,"table",3)(4,"thead",4)(5,"tr")(6,"th",5),l(7,"Cl\xE3"),n(),r(8,"th",6),l(9,"Nome"),n(),r(10,"th",7),l(11,"A\xE7\xF5es"),n()(),r(12,"tr")(13,"th",8),l(14,"Completo"),n(),r(15,"th",8),l(16,"Usu\xE1rio"),n()()(),r(17,"tbody"),I(18,ke,19,9,"ng-container",9),n()()),t&2&&(c(18),y("ngForOf",e.users))},dependencies:[B,de,be,fe,M,k],encapsulation:2})};function Me(d,i){if(d&1&&(A(0),r(1,"option",30),l(2),_(3,"titlecase"),_(4,"uppercase"),n(),W()),d&2){let t=i.$implicit;c(),ae("value",t.id),c(),P("",S(3,3,t.full_name)," | ",S(4,5,t.abbreviation),"")}}var te=class d{constructor(i,t,e,s,a){this.routesService=i;this.clanServ=t;this.userServ=e;this.authService=s;this.errorService=a}subscriptions=new x;clans=[];clanId="";userFullName="";userNickname="";password="";profileType="leader";radio=!1;ngOnInit(){this.getClans()}ngOnDestroy(){this.subscriptions.unsubscribe()}getClans(){this.subscriptions.add=this.clanServ.getAllClans().subscribe({next:i=>{this.clans=i.data,i.token&&this.authService.updateToken(i.token)},error:i=>{this.errorService.handler(i)}})}clanInput(i){this.clanId=i}registerUser(i,t,e,s,a){if(!i||!t||!e||!a)return window.alert("Preencha todos os campos");this.subscriptions.add=this.userServ.registerUser(i,t,e,s,a).subscribe({next:o=>{o.token&&this.authService.updateToken(o.token)},complete:()=>{window.alert("Usu\xE1rio criado com sucesso"),this.clearForms()},error:o=>{this.errorService.handler(o)}})}clearForms(){this.userFullName="",this.userNickname="",this.password=""}toMenu(){this.routesService.navigate.toMenu()}static \u0275fac=function(t){return new(t||d)(u(N),u(ge),u(C),u(T),u(V))};static \u0275cmp=U({type:d,selectors:[["app-user-new"]],standalone:!1,decls:51,vars:7,consts:[["idClan",""],[1,"d-flex","flex-column","align-items-center","justify-content-center"],[1,"bg-dark","bg-opacity-75","border","border-3","border","rounded-3","mb-3","p-3","text-center"],[1,"mb-3"],[1,"bg-dark","bg-opacity-75","border","border-3","rounded-3","mb-3","p-3"],[1,"d-flex","flex-column","justify-content-center","mb-3"],["for","idClan",1,"fs-4","mb-2"],["name","idClan","id","idClan",1,"text-center","rounded","p-1",3,"change"],["value","","selected","","disabled",""],[4,"ngFor","ngForOf"],["for","userFullName",1,"fs-4","mb-2"],["type","text","name","userFullName","id","userFullName","placeholder","Ex: Skyler",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","userNickname",1,"fs-4","mb-2"],["type","text","name","userNickname","id","userNickname","placeholder","Ex: sky_do_ceu",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","password",1,"fs-4","mb-2"],["type","password","name","password","id","password","placeholder","Senha",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-around","mb-3"],[1,"mx-1"],["id","leader","type","radio","name","profile","value","leader",1,"btn-check",3,"ngModelChange","ngModel"],["for","leader",1,"btn","btn-outline-primary","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-megaphone-fill"],["id","staff","type","radio","name","profile","value","staff",1,"btn-check",3,"ngModelChange","ngModel"],["for","staff",1,"btn","btn-outline-warning","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-clipboard-fill"],["id","admin","type","radio","name","profile","value","admin",1,"btn-check",3,"ngModelChange","ngModel"],["for","admin",1,"btn","btn-outline-danger","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-shield-fill-check"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],[3,"value"]],template:function(t,e){if(t&1){let s=w();r(0,"div",1)(1,"div",2)(2,"h1",3),l(3,"Registrar usu\xE1rio"),n()(),r(4,"div",4)(5,"form")(6,"div",5)(7,"label",6),l(8,"Cl\xE3"),n(),r(9,"select",7,0),g("change",function(){p(s);let o=D(10);return m(e.clanInput(o.value))}),r(11,"option",8),l(12,"SELECIONE O CL\xC3"),n(),I(13,Me,5,7,"ng-container",9),n()(),r(14,"div",5)(15,"label",10),l(16,"Nome completo"),n(),r(17,"input",11),v("ngModelChange",function(o){return p(s),h(e.userFullName,o)||(e.userFullName=o),m(o)}),n()(),r(18,"div",5)(19,"label",12),l(20,"Nome de usu\xE1rio"),n(),r(21,"input",13),v("ngModelChange",function(o){return p(s),h(e.userNickname,o)||(e.userNickname=o),m(o)}),n()(),r(22,"div",5)(23,"label",14),l(24,"Senha"),n(),r(25,"input",15),v("ngModelChange",function(o){return p(s),h(e.password,o)||(e.password=o),m(o)}),n()(),r(26,"div",16)(27,"div",17)(28,"input",18),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(29,"label",19),l(30,"L\xEDder"),f(31,"br")(32,"i",20),n()(),r(33,"div",17)(34,"input",21),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(35,"label",22),l(36,"Staff"),f(37,"br")(38,"i",23),n()(),r(39,"div",17)(40,"input",24),v("ngModelChange",function(o){return p(s),h(e.profileType,o)||(e.profileType=o),m(o)}),n(),r(41,"label",25),l(42,"ADM"),f(43,"br")(44,"i",26),n()()(),f(45,"hr"),r(46,"div",27)(47,"button",28),g("click",function(){return p(s),m(e.toMenu())}),l(48,"Voltar"),n(),r(49,"button",29),g("click",function(){return p(s),m(e.registerUser(e.clanId,e.userFullName,e.userNickname,e.password,e.profileType))}),l(50,"Registrar"),n()()()()()}t&2&&(c(13),y("ngForOf",e.clans),c(4),b("ngModel",e.userFullName),c(4),b("ngModel",e.userNickname),c(4),b("ngModel",e.password),c(3),b("ngModel",e.profileType),c(6),b("ngModel",e.profileType),c(6),b("ngModel",e.profileType))},dependencies:[B,J,Q,X,F,K,G,H,q,z,M,k],encapsulation:2})};var Ne=[{path:"new",component:te,canActivate:[Y,Z]},{path:"list",component:ee,canActivate:[Y,Z]},{path:"edit/:id",component:$,canActivate:[Y,Z]}],ie=class d{static \u0275fac=function(t){return new(t||d)};static \u0275mod=R({type:d});static \u0275inj=O({imports:[ne.forChild(Ne),ne]})};var Ce=class d{static \u0275fac=function(t){return new(t||d)};static \u0275mod=R({type:d});static \u0275inj=O({imports:[pe,ie]})};export{Ce as UserModule};
