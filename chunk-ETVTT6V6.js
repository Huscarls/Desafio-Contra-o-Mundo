import{a as V}from"./chunk-SCJLMKBA.js";import{a as Y}from"./chunk-GAETHVTS.js";import{a as pe}from"./chunk-7OZZ35HU.js";import{A as g,B as y,C as ne,D as P,E as a,Ea as de,F as j,Fa as X,Ga as me,H as F,K as b,L as h,M as v,O as _,P as S,R as oe,T as A,U as se,W as U,X as M,Y as ae,e as W,ga as le,h as d,i as m,ka as re,m as p,ma as k,n as u,na as N,o as E,oa as T,p as D,pa as x,qa as R,r as I,ra as B,s as C,sa as G,ta as z,u as t,ua as q,v as i,va as H,w as f,x as L,xa as J,y as O,ya as K,z as w,za as Q}from"./chunk-U5BTYTSX.js";var Z=class c{constructor(n,r,e,s,l){this.routeService=n;this.route=r;this.userService=e;this.authService=s;this.errorService=l}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.idUser=this.route.snapshot.params.id,this.getUser(this.idUser)}subscriptions=new T;idUser;user;profileType="";newPassword="";getUser(n){this.subscriptions.add=this.userService.getUser(n).subscribe({next:r=>{this.user=r.data,r.token&&this.authService.updateToken(r.token)},complete:()=>{this.user.is_leader?this.profileType="leader":this.user.is_staff?this.profileType="staff":this.user.is_admin&&(this.profileType="admin")},error:r=>{this.errorService.handler(r)}})}toUsersList(){this.routeService.navigate.toUserList()}updateUser(){this.subscriptions.add=this.userService.updateUser(this.idUser,this.user.full_name,this.user.username,this.profileType).subscribe({next:n=>{n.token&&this.authService.updateToken(n.token)},complete:()=>{window.alert("Usu\xE1rio atualizado com sucesso"),this.toUsersList()},error:n=>{this.errorService.handler(n)}})}changePassword(n){n.length<8||!window.confirm(`Deseja realmente alterar a senha do usu\xE1rio ${this.user.full_name.toUpperCase()} | ${this.user.username.toUpperCase()}?
Essa a\xE7\xE3o \xE9 irrevers\xEDvel!`)||(this.subscriptions.add=this.userService.changePasswordOverride(this.user.id,n).subscribe({next:e=>{e.token&&this.authService.updateToken(e.token)},complete:()=>{window.alert("Senha alterada com sucesso"),this.newPassword=""},error:e=>{this.errorService.handler(e)}}))}static \u0275fac=function(r){return new(r||c)(u(k),u(le),u(V),u(N),u(x))};static \u0275cmp=E({type:c,selectors:[["app-user-edit"]],standalone:!1,decls:67,vars:13,consts:[["idClan",""],[1,"d-flex","flex-column","align-items-center","justify-content-center"],[1,"mb-3"],[1,"bg-dark","bg-opacity-75","border","border-3","border-light","rounded-3","mb-3","p-3"],[1,"d-flex","flex-column","justify-content-center","mb-3"],["for","idClan",1,"fs-4","mb-2"],["disabled","","name","idClan","id","idClan",1,"text-center","rounded","p-1"],["value","","disabled",""],["value","","selected","","disabled",""],["for","userFullName",1,"fs-4","mb-2"],["type","text","name","userFullName","id","userFullName","placeholder","Ex: Skyler",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","userNickname",1,"fs-4","mb-2"],["type","text","name","userNickname","id","userNickname","placeholder","Ex: sky_do_ceu",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-around","mb-3"],[1,"mx-1"],["id","leader","type","radio","name","profile","value","leader",1,"btn-check",3,"ngModelChange","ngModel"],["for","leader",1,"btn","btn-outline-primary","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-megaphone-fill"],["id","staff","type","radio","name","profile","value","staff",1,"btn-check",3,"ngModelChange","ngModel"],["for","staff",1,"btn","btn-outline-warning","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-clipboard-fill"],["id","admin","type","radio","name","profile","value","admin",1,"btn-check",3,"ngModelChange","ngModel"],["for","admin",1,"btn","btn-outline-danger","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-shield-fill-check"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],[1,"text-center","mb-3"],["for","password",1,"fs-4","mb-2"],["type","password","name","password","id","password","placeholder","Senha",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"fw-bold"],[1,"d-flex","align-items-center","justify-content-center","mb-3"],[1,"btn","btn-outline-danger",3,"click","disabled"]],template:function(r,e){if(r&1){let s=w();t(0,"div",1)(1,"h1",2),a(2,"Atualizar usu\xE1rio"),i(),t(3,"div",3)(4,"form")(5,"div",4)(6,"label",5),a(7,"Cl\xE3"),i(),t(8,"select",6,0)(10,"option",7),a(11,"SELECIONE O CL\xC3"),i(),t(12,"option",8),a(13),_(14,"titlecase"),_(15,"uppercase"),i()()(),t(16,"div",4)(17,"label",9),a(18,"Nome completo"),i(),t(19,"input",10),v("ngModelChange",function(o){return d(s),h(e.user.full_name,o)||(e.user.full_name=o),m(o)}),i()(),t(20,"div",4)(21,"label",11),a(22,"Nome de usu\xE1rio"),i(),t(23,"input",12),v("ngModelChange",function(o){return d(s),h(e.user.username,o)||(e.user.username=o),m(o)}),i()(),t(24,"div",13)(25,"div",14)(26,"input",15),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(27,"label",16),a(28,"L\xEDder"),f(29,"br")(30,"i",17),i()(),t(31,"div",14)(32,"input",18),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(33,"label",19),a(34,"Staff"),f(35,"br")(36,"i",20),i()(),t(37,"div",14)(38,"input",21),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(39,"label",22),a(40,"ADM"),f(41,"br")(42,"i",23),i()()(),f(43,"hr"),t(44,"div",24)(45,"button",25),g("click",function(){return d(s),m(e.toUsersList())}),a(46,"Voltar"),i(),t(47,"button",26),g("click",function(){return d(s),m(e.updateUser())}),a(48,"Registrar"),i()()()()(),f(49,"hr"),t(50,"div",1)(51,"h1",27),a(52,"Redefinir senha"),i(),t(53,"div",3)(54,"form")(55,"div",4)(56,"label",28),a(57,"Nova senha"),i(),t(58,"input",29),v("ngModelChange",function(o){return d(s),h(e.newPassword,o)||(e.newPassword=o),m(o)}),i(),f(59,"br"),t(60,"p"),a(61,"Aten\xE7\xE3o, n\xE3o altere a senha sem pr\xE9vio aviso/pedido do usu\xE1rio."),i(),t(62,"p",30),a(63,"Essa a\xE7\xE3o n\xE3o pode ser desfeita!"),i()(),t(64,"div",31)(65,"button",32),g("click",function(){return d(s),m(e.changePassword(e.newPassword))}),a(66,"Atualizar senha"),i()()()()()}r&2&&(p(13),F("",S(14,9,e.user.clan.full_name)," | ",S(15,11,e.user.clan.abbreviation),""),p(6),b("ngModel",e.user.full_name),p(4),b("ngModel",e.user.username),p(3),b("ngModel",e.profileType),p(6),b("ngModel",e.profileType),p(6),b("ngModel",e.profileType),p(20),b("ngModel",e.newPassword),p(7),C("disabled",e.newPassword.length<8))},dependencies:[H,K,Q,R,J,B,G,q,z,M,U],encapsulation:2})};function Se(c,n){if(c&1){let r=w();t(0,"td",4)(1,"button",15),g("click",function(){d(r);let s=y().$implicit,l=y();return m(l.enableUser(s.id,s.username))}),a(2,"Habilitar"),i()()}}function we(c,n){if(c&1){let r=w();t(0,"td")(1,"button",16),g("click",function(){d(r);let s=y().$implicit,l=y();return m(l.disableUser(s.id,s.full_name))}),a(2,"Desabilitar"),i()()}}function Ce(c,n){if(c&1){let r=w();L(0),t(1,"tr")(2,"td",4),a(3),_(4,"uppercase"),i(),t(5,"td",4),a(6),_(7,"titlecase"),i(),t(8,"td",4),a(9),i(),I(10,Se,3,0,"td",10)(11,we,3,0,"ng-template",null,0,oe),t(13,"td",4)(14,"button",11),g("click",function(){let s=d(r).$implicit,l=y();return m(l.toEditUser(s.id))}),f(15,"i",12),i()(),t(16,"td",4)(17,"button",13),g("click",function(){let s=d(r).$implicit,l=y();return m(l.deleteUser(s.id,s.full_name,s.clan.full_name))}),f(18,"i",14),i()()(),O()}if(c&2){let r=n.$implicit,e=P(12);p(3),j(S(4,5,r.clan.abbreviation)),p(3),j(S(7,7,r.full_name)),p(3),j(r.username),p(),C("ngIf",!r.is_enabled)("ngIfElse",e)}}var ee=class c{constructor(n,r,e,s){this.routesService=n;this.authService=r;this.userService=e;this.errorService=s}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnInit(){this.refreshData()}subscriptions=new T;users=[];usersMap={};refreshData(){this.getUsers()}getUsers(){this.subscriptions.add=this.userService.getAllUsers().subscribe({next:n=>{n.token&&this.authService.updateToken(n.token),this.users=n.data},complete:()=>this.mapIndexes(),error:n=>{this.errorService.handler(n)}})}disableUser(n,r){window.confirm("Desabilitar "+r+"?")&&(this.subscriptions.add=this.userService.disableUser(n).subscribe({next:s=>{s.token&&this.authService.updateToken(s.token)},complete:()=>{window.alert(`Usu\xE1rio ${r} desativado!`),this.users[this.usersMap[n]].is_enabled=!1},error:s=>{this.errorService.handler(s)}}))}enableUser(n,r){window.confirm("Reativar "+r+"?")&&(this.subscriptions.add=this.userService.enableUser(n).subscribe({next:s=>{s.token&&this.authService.updateToken(s.token)},complete:()=>{window.alert(`Usu\xE1rio ${r} reativado!`),this.users[this.usersMap[n]].is_enabled=!0},error:s=>{this.errorService.handler(s)}}))}toEditUser(n){this.routesService.navigate.toUserEdit(n)}deleteUser(n,r,e){window.confirm(`Remover todos os acessos de ${r} do cl\xE3 ${e.toUpperCase()}?`)&&(this.subscriptions.add=this.userService.deleteUser(n).subscribe({next:l=>{l.token&&this.authService.updateToken(l.token)},complete:()=>{window.alert("Usu\xE1rio removido");let l=this.usersMap[n];this.users.splice(l,1),this.mapIndexes()},error:l=>{this.errorService.handler(l)}}))}mapIndexes(){this.usersMap=this.userService.mapUsers(this.users)}static \u0275fac=function(r){return new(r||c)(u(k),u(N),u(V),u(x))};static \u0275cmp=E({type:c,selectors:[["app-user-list"]],standalone:!1,decls:19,vars:1,consts:[["notEnabled",""],[1,"d-flex","justify-content-around","my-2","p-1","align-items-center"],[3,"refreshData"],[1,"table","table-striped","table-bordered","text-center"],[1,"align-middle"],["colspan","1","rowspan","2",1,"fs-4"],["colspan","2",1,"fs-4"],["colspan","3","rowspan","2",1,"fs-4"],[1,"fs-4"],[4,"ngFor","ngForOf"],["class","align-middle",4,"ngIf","ngIfElse"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-square"],[1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash-fill"],[1,"btn","btn-outline-success",3,"click"],[1,"btn","btn-outline-warning",3,"click"]],template:function(r,e){r&1&&(t(0,"div",1),f(1,"app-button-back-to-menu"),t(2,"app-button-refresh-data",2),g("refreshData",function(){return e.refreshData()}),i()(),t(3,"table",3)(4,"thead",4)(5,"tr")(6,"th",5),a(7,"Cl\xE3"),i(),t(8,"th",6),a(9,"Nome"),i(),t(10,"th",7),a(11,"A\xE7\xF5es"),i()(),t(12,"tr")(13,"th",8),a(14,"Completo"),i(),t(15,"th",8),a(16,"Usu\xE1rio"),i()()(),t(17,"tbody"),I(18,Ce,19,9,"ng-container",9),i()()),r&2&&(p(18),C("ngForOf",e.users))},dependencies:[A,se,pe,de,M,U],encapsulation:2})};function ye(c,n){if(c&1&&(L(0),t(1,"option",30),a(2),_(3,"titlecase"),_(4,"uppercase"),i(),O()),c&2){let r=n.$implicit;p(),ne("value",r.id),p(),F("",S(3,3,r.full_name)," | ",S(4,5,r.abbreviation),"")}}var te=class c{constructor(n,r,e,s,l){this.routesService=n;this.clanServ=r;this.userServ=e;this.authService=s;this.errorService=l}subscriptions=new T;clans=[];clanId="";userFullName="";userNickname="";password="";profileType="leader";radio=!1;ngOnInit(){this.getClans()}ngOnDestroy(){this.subscriptions.unsubscribe()}getClans(){this.subscriptions.add=this.clanServ.getAllClans().subscribe({next:n=>{this.clans=n.data,n.token&&this.authService.updateToken(n.token)},error:n=>{this.errorService.handler(n)}})}clanInput(n){this.clanId=n}registerUser(n,r,e,s,l){if(!n||!r||!e||!l)return window.alert("Preencha todos os campos");this.subscriptions.add=this.userServ.registerUser(n,r,e,s,l).subscribe({next:o=>{o.token&&this.authService.updateToken(o.token)},complete:()=>{window.alert("Usu\xE1rio criado com sucesso"),this.clearForms()},error:o=>{this.errorService.handler(o)}})}clearForms(){this.userFullName="",this.userNickname="",this.password=""}toMenu(){this.routesService.navigate.toMenu()}static \u0275fac=function(r){return new(r||c)(u(k),u(me),u(V),u(N),u(x))};static \u0275cmp=E({type:c,selectors:[["app-user-new"]],standalone:!1,decls:51,vars:7,consts:[["idClan",""],[1,"d-flex","flex-column","align-items-center","justify-content-center"],[1,"bg-dark","bg-opacity-75","border","border-3","border","rounded-3","mb-3","p-3","text-center"],[1,"mb-3"],[1,"bg-dark","bg-opacity-75","border","border-3","rounded-3","mb-3","p-3"],[1,"d-flex","flex-column","justify-content-center","mb-3"],["for","idClan",1,"fs-4","mb-2"],["name","idClan","id","idClan",1,"text-center","rounded","p-1",3,"change"],["value","","selected","","disabled",""],[4,"ngFor","ngForOf"],["for","userFullName",1,"fs-4","mb-2"],["type","text","name","userFullName","id","userFullName","placeholder","Ex: Skyler",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","userNickname",1,"fs-4","mb-2"],["type","text","name","userNickname","id","userNickname","placeholder","Ex: sky_do_ceu",1,"text-center","rounded",3,"ngModelChange","ngModel"],["for","password",1,"fs-4","mb-2"],["type","password","name","password","id","password","placeholder","Senha",1,"text-center","rounded",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-around","mb-3"],[1,"mx-1"],["id","leader","type","radio","name","profile","value","leader",1,"btn-check",3,"ngModelChange","ngModel"],["for","leader",1,"btn","btn-outline-primary","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-megaphone-fill"],["id","staff","type","radio","name","profile","value","staff",1,"btn-check",3,"ngModelChange","ngModel"],["for","staff",1,"btn","btn-outline-warning","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-clipboard-fill"],["id","admin","type","radio","name","profile","value","admin",1,"btn-check",3,"ngModelChange","ngModel"],["for","admin",1,"btn","btn-outline-danger","border-light","border-1","fs-5","mb-2"],[1,"bi","bi-shield-fill-check"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-success",3,"click"],[3,"value"]],template:function(r,e){if(r&1){let s=w();t(0,"div",1)(1,"div",2)(2,"h1",3),a(3,"Registrar usu\xE1rio"),i()(),t(4,"div",4)(5,"form")(6,"div",5)(7,"label",6),a(8,"Cl\xE3"),i(),t(9,"select",7,0),g("change",function(){d(s);let o=P(10);return m(e.clanInput(o.value))}),t(11,"option",8),a(12,"SELECIONE O CL\xC3"),i(),I(13,ye,5,7,"ng-container",9),i()(),t(14,"div",5)(15,"label",10),a(16,"Nome completo"),i(),t(17,"input",11),v("ngModelChange",function(o){return d(s),h(e.userFullName,o)||(e.userFullName=o),m(o)}),i()(),t(18,"div",5)(19,"label",12),a(20,"Nome de usu\xE1rio"),i(),t(21,"input",13),v("ngModelChange",function(o){return d(s),h(e.userNickname,o)||(e.userNickname=o),m(o)}),i()(),t(22,"div",5)(23,"label",14),a(24,"Senha"),i(),t(25,"input",15),v("ngModelChange",function(o){return d(s),h(e.password,o)||(e.password=o),m(o)}),i()(),t(26,"div",16)(27,"div",17)(28,"input",18),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(29,"label",19),a(30,"L\xEDder"),f(31,"br")(32,"i",20),i()(),t(33,"div",17)(34,"input",21),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(35,"label",22),a(36,"Staff"),f(37,"br")(38,"i",23),i()(),t(39,"div",17)(40,"input",24),v("ngModelChange",function(o){return d(s),h(e.profileType,o)||(e.profileType=o),m(o)}),i(),t(41,"label",25),a(42,"ADM"),f(43,"br")(44,"i",26),i()()(),f(45,"hr"),t(46,"div",27)(47,"button",28),g("click",function(){return d(s),m(e.toMenu())}),a(48,"Voltar"),i(),t(49,"button",29),g("click",function(){return d(s),m(e.registerUser(e.clanId,e.userFullName,e.userNickname,e.password,e.profileType))}),a(50,"Registrar"),i()()()()()}r&2&&(p(13),C("ngForOf",e.clans),p(4),b("ngModel",e.userFullName),p(4),b("ngModel",e.userNickname),p(4),b("ngModel",e.password),p(3),b("ngModel",e.profileType),p(6),b("ngModel",e.profileType),p(6),b("ngModel",e.profileType))},dependencies:[A,H,K,Q,R,J,B,G,q,z,M,U],encapsulation:2})};var Ee=[{path:"new",component:te,canActivate:[X,Y]},{path:"list",component:ee,canActivate:[X,Y]},{path:"edit/:id",component:Z,canActivate:[X,Y]}],ie=class c{static \u0275fac=function(r){return new(r||c)};static \u0275mod=D({type:c});static \u0275inj=W({imports:[re.forChild(Ee),re]})};var ve=class c{static \u0275fac=function(r){return new(r||c)};static \u0275mod=D({type:c});static \u0275inj=W({imports:[ae,ie]})};export{ve as UserModule};
